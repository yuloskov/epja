#!/user/bin/env node
const {program} = require('commander')
const { inherits } = require('util')
const package = require('../package');

program
  .option('--init', 'init app')
  .options('--server', 'run server')
  .version(package.version)
  .on('--help', ()=> {
    console.log('pomosh')
  })
  .parse()

const options = program.opts()
if (options.init) {
  // smth with package json
  require('child_process').execSync('npm i react', {stdio: inherits})
  const path = require('path')
  const fs = require('fs')
  const packagepath = path.resolve('package.json')

  const package = require(packagepath)
  package.scripts = package.scripts || {}
  package.scripts.start = 'npx komandaaa-cli --server'

  fs.writeFileSync(packagepath, JSON.stringify(package, null, 4))
  console.log(packagepath)
}

if (option.server) {
  const startServer = require('@komandaaa/dev-server')

  startServer({port: 4001})
  console.log(111)
}